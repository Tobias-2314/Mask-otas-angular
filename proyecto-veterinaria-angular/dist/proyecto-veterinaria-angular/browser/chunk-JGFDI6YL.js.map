{
  "version": 3,
  "sources": ["src/app/core/services/auth.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\nimport { environment } from '../../../environments/environment';\r\n\r\nexport interface User {\r\n    id?: number;\r\n    username: string;\r\n    email: string;\r\n    countryCode?: string;\r\n    cityId?: number;\r\n    isAdmin?: boolean;\r\n}\r\n\r\nexport interface LoginResponse {\r\n    access_token: string;\r\n    user: User;\r\n}\r\n\r\nexport interface RegisterResponse {\r\n    message: string;\r\n    user: User;\r\n}\r\n\r\nexport interface RegisterData {\r\n    username: string;\r\n    email: string;\r\n    password: string;\r\n    countryCode: string;\r\n    cityId: number;\r\n}\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n    private currentUserSubject = new BehaviorSubject<User | null>(null);\r\n    public currentUser$ = this.currentUserSubject.asObservable();\r\n    private apiUrl = environment.apiUrl;\r\n\r\n    constructor(private http: HttpClient) {\r\n        // Cargar usuario desde localStorage si existe\r\n        const savedUser = localStorage.getItem('currentUser');\r\n        if (savedUser) {\r\n            this.currentUserSubject.next(JSON.parse(savedUser));\r\n        }\r\n    }\r\n\r\n    get currentUserValue(): User | null {\r\n        return this.currentUserSubject.value;\r\n    }\r\n\r\n    get isLoggedIn(): boolean {\r\n        return this.currentUserSubject.value !== null && this.getToken() !== null;\r\n    }\r\n\r\n    getToken(): string | null {\r\n        return localStorage.getItem('access_token');\r\n    }\r\n\r\n    login(email: string, password: string): Observable<any> {\r\n        const headers = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n        const body = { email, password };\r\n\r\n        return this.http.post<LoginResponse>(`${this.apiUrl}/auth/login`, body, { headers })\r\n            .pipe(\r\n                tap(response => {\r\n                    if (response.access_token && response.user) {\r\n                        // Guardar token y usuario\r\n                        localStorage.setItem('access_token', response.access_token);\r\n                        localStorage.setItem('currentUser', JSON.stringify(response.user));\r\n                        this.currentUserSubject.next(response.user);\r\n                    }\r\n                }),\r\n                catchError(error => {\r\n                    console.error('Error de login:', error);\r\n                    const errorMessage = error.error?.message || 'Error de conexión con el servidor';\r\n                    throw { success: false, message: errorMessage };\r\n                })\r\n            );\r\n    }\r\n\r\n    register(data: RegisterData): Observable<any> {\r\n        const headers = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n\r\n        return this.http.post<RegisterResponse>(`${this.apiUrl}/auth/register`, data, { headers })\r\n            .pipe(\r\n                catchError(error => {\r\n                    console.error('Error de registro:', error);\r\n                    const errorMessage = error.error?.message || 'Error de conexión con el servidor';\r\n                    throw { success: false, message: errorMessage };\r\n                })\r\n            );\r\n    }\r\n\r\n    logout(): void {\r\n        localStorage.removeItem('access_token');\r\n        localStorage.removeItem('currentUser');\r\n        this.currentUserSubject.next(null);\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAoCM,IAAO,cAAP,MAAO,aAAW;EAKpB,YAAoB,MAAgB;AAAhB,SAAA,OAAA;AAJZ,SAAA,qBAAqB,IAAI,gBAA6B,IAAI;AAC3D,SAAA,eAAe,KAAK,mBAAmB,aAAY;AAClD,SAAA,SAAS,YAAY;AAIzB,UAAM,YAAY,aAAa,QAAQ,aAAa;AACpD,QAAI,WAAW;AACX,WAAK,mBAAmB,KAAK,KAAK,MAAM,SAAS,CAAC;IACtD;EACJ;EAEA,IAAI,mBAAgB;AAChB,WAAO,KAAK,mBAAmB;EACnC;EAEA,IAAI,aAAU;AACV,WAAO,KAAK,mBAAmB,UAAU,QAAQ,KAAK,SAAQ,MAAO;EACzE;EAEA,WAAQ;AACJ,WAAO,aAAa,QAAQ,cAAc;EAC9C;EAEA,MAAM,OAAe,UAAgB;AACjC,UAAM,UAAU,IAAI,YAAY,EAAE,gBAAgB,mBAAkB,CAAE;AACtE,UAAM,OAAO,EAAE,OAAO,SAAQ;AAE9B,WAAO,KAAK,KAAK,KAAoB,GAAG,KAAK,MAAM,eAAe,MAAM,EAAE,QAAO,CAAE,EAC9E,KACG,IAAI,cAAW;AACX,UAAI,SAAS,gBAAgB,SAAS,MAAM;AAExC,qBAAa,QAAQ,gBAAgB,SAAS,YAAY;AAC1D,qBAAa,QAAQ,eAAe,KAAK,UAAU,SAAS,IAAI,CAAC;AACjE,aAAK,mBAAmB,KAAK,SAAS,IAAI;MAC9C;IACJ,CAAC,GACD,WAAW,WAAQ;AACf,cAAQ,MAAM,mBAAmB,KAAK;AACtC,YAAM,eAAe,MAAM,OAAO,WAAW;AAC7C,YAAM,EAAE,SAAS,OAAO,SAAS,aAAY;IACjD,CAAC,CAAC;EAEd;EAEA,SAAS,MAAkB;AACvB,UAAM,UAAU,IAAI,YAAY,EAAE,gBAAgB,mBAAkB,CAAE;AAEtE,WAAO,KAAK,KAAK,KAAuB,GAAG,KAAK,MAAM,kBAAkB,MAAM,EAAE,QAAO,CAAE,EACpF,KACG,WAAW,WAAQ;AACf,cAAQ,MAAM,sBAAsB,KAAK;AACzC,YAAM,eAAe,MAAM,OAAO,WAAW;AAC7C,YAAM,EAAE,SAAS,OAAO,SAAS,aAAY;IACjD,CAAC,CAAC;EAEd;EAEA,SAAM;AACF,iBAAa,WAAW,cAAc;AACtC,iBAAa,WAAW,aAAa;AACrC,SAAK,mBAAmB,KAAK,IAAI;EACrC;;;uCAhES,cAAW,mBAAA,UAAA,CAAA;IAAA;EAAA;;4EAAX,cAAW,SAAX,aAAW,WAAA,YAFR,OAAM,CAAA;EAAA;;",
  "names": []
}
